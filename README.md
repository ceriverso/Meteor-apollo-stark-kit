# Meteor, Apollo, React, PWA, Styled-Components boilerplate

A simple kit to start experimenting with Apollo, Meteor, React, PWA and Styled Components.

Code is deployed here: https://meteor-apollo-starter.herokuapp.com/

Lighthouse audit:
![meteor-apollo-light-house](https://user-images.githubusercontent.com/16927407/33520209-a856dc66-d7b6-11e7-9b6c-acc36ea2ee4f.png)

### This project includes the following libraries/functionality
- GraphQL server running with Express bound to the Meteor app
- Apollo 2
- React 16
- Redux
- Meteor accounts (password & facebook)
- ES6 syntax
- [styled components](https://youtu.be/qu4U7lwZTRI)
- service worker (Progressive Web App)
- Storybook
- sanitize.css
- basscss

### Running the app
First, clone the project and install NPM dependecies:
```
git clone https://github.com/fede-rodes/meteor-apollo-starter-kit.git
cd meteor-apollo-starter-kit/
meteor npm install
```
After that, define your settings-dev.json based on the provided settings-dev.sample.json file. You'll need to register the app in both mailgun and facebook (more on this [here](https://medium.com/@jaaaco/add-facebook-login-to-meteor-app-in-2-minutes-3c744b46009e)).

Finally, run the app:
```
meteor --settings settings-dev.json
```
GraphiQL will be available at [http://localhost:3000/graphiql](http://localhost:3000/graphiql).

### Running storybook
Open a new terminal (the meteor app doesn't need to be running) and type:
```
npm i -g @storybook/cli
npm run storybook
```
Stroybook will be available at [http://localhost:6006/](http://localhost:6006/).

### Favicon / manifest generator
In order to generate the favicons for your project, you can use the following generator:
https://realfavicongenerator.net/

### Bundle-visualizer
```
cd meteor-apollo-starter-kit/
meteor --extra-packages bundle-visualizer --production --settings settings-dev.json
```

Then go to: [http://localhost:3000/](http://localhost:3000/)

Finding dependencies:
```
npm ls <lib-name>
```

Before deploying to production, if you used --extra-packages, simply remove bundle-visualizer from the list of included packages and run meteor as normal.

Learn more at:
- https://blog.meteor.com/announcing-meteor-1-5-b82be66571bb
- https://blog.meteor.com/putting-your-app-on-a-diet-with-meteor-1-5s-bundle-visualizer-6845b685a119

### Lighthouse
```
npm install -g lighthouse
# or use yarn:
# yarn global add lighthouse
```

Open a new terminal and run: lighthouse http://localhost:3000

In case you run lighthouse inside the /meteor-apollo-starter-kit app's folder, you'll need to delete the report generated by the audit to avoid a static-html error. See [issue #60](https://github.com/fede-rodes/meteor-apollo-starter-kit/issues/60) for more info

### Look for meteor package dependencies
The following command is handy when trying to reduce your client bundle size and need to identify where the dependencies are coming from.
```
meteor list --tree

OR

for p in `meteor list | grep '^[a-z]' | awk '{sub(/[+*]$/, "", $2);
print $1"@"$2 }'`;
do echo "$p";
meteor show "$p" | grep -E '^  [a-z]';
echo;
done
```
Learn more:
- https://github.com/meteor/meteor/issues/2853#issuecomment-283320603


### Deploy to heroku
```
1. git clone https://github.com/fede-rodes/meteor-apollo-starter-kit.git
2. cd meteor-apollo-starter-kit
3. heroku login (enter your credentials)
4. heroku create <YOUR_APP_NAME>
5. heroku buildpacks:set https://github.com/AdmitHub/meteor-buildpack-horse.git
6. heroku addons:create mongolab
OR
6. heroku config:set MONGO_URL=mongodb://<dbuser>:<dbpassword>@<something>.mlab.com:<port>/<dbname>
7. heroku config:set ROOT_URL=https://<YOUR_APP_NAME>.herokuapp.com
8. heroku config:add METEOR_SETTINGS="$(cat settings.json)"
9. git push heroku master
OR (if you are working on a different branch than master)
9. git push heroku <BRANCH-NAME>:master
10. heroku open
```

### Resources

#### Meteor Apollo
- [Meteor `apollo` package docs](http://dev.apollodata.com/core/meteor.html)
- [Apollo docs](http://dev.apollodata.com/)
- https://blog.meteor.com/create-a-simple-hello-world-app-with-meteor-and-apollo-64bab66a456f


#### Progressive Web Apps
- https://medium.com/@addyosmani/progressive-web-apps-with-react-js-part-i-introduction-50679aef2b12
- https://www.made-on-mars.com/blog/how-to-pwa-an-introduction-on-progressive-web-app-and-a-tutorial-to-create-one-with-full-features-push-notification-service-worker-offline-mode/
- https://github.com/NitroBAY/meteor-service-worker
- https://github.com/saurshaz/pwa-meteor/blob/master/client/serviceWorker.js
- https://developers.google.com/web/tools/workbox/
- https://youtu.be/cmGr0RszHc8

#### Service Worker
- https://classroom.udacity.com/courses/ud899

#### Dynamic imports
- https://youtu.be/j-WcyAjVceM


### TODO LIST

- https://github.com/meteor/meteor/blob/devel/packages/server-render/README.md#usage

- tests
- react helmet
- ssr to speed-up first load and SEO
- https://reactjs.org/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab
- https://www.webpagetest.org
- https://stackify.com/what-is-real-user-monitoring/
- css outside imports folder (lazy load) is better for performance?
- Better to load from DNS?

What about this? We are not using it:
https://guide.meteor.com/accounts.html
```
Accounts.onResetPasswordLink
Accounts.onEnrollmentLink
Accounts.onEmailVerificationLink
Hereâ€™s how you would use one of these functions:

Accounts.onResetPasswordLink((token, done) => {
  // Display the password reset UI, get the new password...
  Accounts.resetPassword(token, newPassword, (err) => {
    if (err) {
      // Display error
    } else {
      // Resume normal operation
      done();
    }
  });
})
```

### UI components library built with styled components:
- https://ak-mk-2-prod.netlify.com/packages/elements/datetime-picker
